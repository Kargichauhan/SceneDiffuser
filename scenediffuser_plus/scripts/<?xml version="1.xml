<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="5.0" etag="vfsi_architecture" version="21.0.0" type="device">
  <diagram name="VFSI-Architecture" id="vfsi_main">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="1" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="&lt;b&gt;&lt;font size=&quot;20&quot;&gt;Validity-First Spatial Intelligence (VFSI) Architecture&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;i&gt;Treating Physical Constraints as Non-Negotiable Primitives&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="800" height="60" as="geometry" />
        </mxCell>
        
        <!-- INPUT LAYER -->
        <!-- Scene Context -->
        <mxCell id="scene_context" value="&lt;b&gt;Scene Context&lt;/b&gt;&lt;br&gt;• Road graph&lt;br&gt;• Traffic lights&lt;br&gt;• Lane geometry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F4FD;strokeColor=#000000;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="300" y="120" width="180" height="100" as="geometry" />
        </mxCell>
        
        <!-- Agent States -->
        <mxCell id="agent_states" value="&lt;b&gt;Agent States&lt;/b&gt;&lt;br&gt;• Positions (x,y)&lt;br&gt;• Velocities (v&lt;sub&gt;x&lt;/sub&gt;,v&lt;sub&gt;y&lt;/sub&gt;)&lt;br&gt;• Accelerations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F4FD;strokeColor=#000000;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="520" y="120" width="180" height="100" as="geometry" />
        </mxCell>
        
        <!-- HIERARCHICAL DIFFUSION CORE -->
        <!-- Agent-Specific Stream -->
        <mxCell id="agent_stream" value="&lt;b&gt;Agent-Specific&lt;br&gt;Diffusion Stream&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B8E0D2;strokeColor=#2E7D32;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="200" y="280" width="160" height="180" as="geometry" />
        </mxCell>
        
        <!-- Transformer Blocks inside Agent Stream -->
        <mxCell id="transformer1" value="Transformer Block 1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="210" y="320" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="transformer2" value="Transformer Block 2" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="210" y="360" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="transformer3" value="Transformer Block 3" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="210" y="400" width="140" height="30" as="geometry" />
        </mxCell>
        
        <!-- Scene-Level Stream -->
        <mxCell id="scene_stream" value="&lt;b&gt;Scene-Level&lt;br&gt;Diffusion Stream&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B8E0D2;strokeColor=#2E7D32;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="380" y="280" width="160" height="180" as="geometry" />
        </mxCell>
        
        <!-- CNN/MLP Blocks inside Scene Stream -->
        <mxCell id="cnn1" value="CNN/MLP Layer 1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="390" y="320" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="cnn2" value="CNN/MLP Layer 2" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="390" y="360" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="cnn3" value="CNN/MLP Layer 3" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="390" y="400" width="140" height="30" as="geometry" />
        </mxCell>
        
        <!-- Message Exchange Arrow -->
        <mxCell id="message_exchange" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#4169E1;startArrow=classic;startFill=1;endArrow=classic;endFill=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="370" as="sourcePoint" />
            <mxPoint x="380" y="370" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="message_label" value="Message&lt;br&gt;Exchange" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="340" y="380" width="60" height="40" as="geometry" />
        </mxCell>
        
        <!-- PHYSICS-INFORMED COLLISION MODULE (KEY INNOVATION) -->
        <mxCell id="collision_module" value="&lt;b&gt;🔴 Physics-Informed Collision Module&lt;/b&gt;&lt;br&gt;&lt;br&gt;$$\Phi_{coll}(x_i,x_j) = k_c\left(\frac{1}{||p_i-p_j||_2} - \frac{1}{d_{safe}}\right)^2$$&lt;br&gt;&lt;br&gt;• Differentiable potential field&lt;br&gt;• Repulsive forces at d &lt; 4m" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFB6C1;strokeColor=#FF0000;strokeWidth=4;" vertex="1" parent="1">
          <mxGeometry x="600" y="280" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- KINEMATIC CONSISTENCY MODULE -->
        <mxCell id="kinematic_module" value="&lt;b&gt;🔴 Kinematic Consistency Module&lt;/b&gt;&lt;br&gt;&lt;br&gt;$$\mathcal{L}_{kin} = \lambda_v||v||_{&gt;v_{max}} + \lambda_a||a||_{&gt;a_{max}}$$&lt;br&gt;&lt;br&gt;• Max velocity: 15 m/s&lt;br&gt;• Max acceleration: 5 m/s²" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFB6C1;strokeColor=#FF0000;strokeWidth=4;" vertex="1" parent="1">
          <mxGeometry x="600" y="420" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- KEY INNOVATION STAR -->
        <mxCell id="star" value="⭐ KEY INNOVATION ⭐" style="text;html=1;strokeColor=none;fillColor=#FFD700;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="660" y="240" width="160" height="30" as="geometry" />
        </mxCell>
        
        <!-- DYNAMIC GRAPH NETWORK -->
        <mxCell id="graph_network" value="&lt;b&gt;Dynamic Graph Network&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFD700;strokeColor=#FF8C00;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="920" y="340" width="240" height="140" as="geometry" />
        </mxCell>
        
        <!-- Graph visualization inside -->
        <mxCell id="node1" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#FFFFFF;strokeColor=#FF8C00;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="960" y="380" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="node2" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#FFFFFF;strokeColor=#FF8C00;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1060" y="380" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="node3" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#FFFFFF;strokeColor=#FF8C00;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="960" y="430" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="node4" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#FFFFFF;strokeColor=#FF8C00;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1060" y="430" width="30" height="30" as="geometry" />
        </mxCell>
        
        <!-- Graph edges -->
        <mxCell id="edge1" style="endArrow=none;html=1;strokeWidth=2;strokeColor=#FF8C00;" edge="1" parent="1" source="node1" target="node2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge2" style="endArrow=none;html=1;strokeWidth=2;strokeColor=#FF8C00;" edge="1" parent="1" source="node1" target="node3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge3" style="endArrow=none;html=1;strokeWidth=2;strokeColor=#FF8C00;" edge="1" parent="1" source="node2" target="node4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge4" style="endArrow=none;html=1;strokeWidth=2;strokeColor=#FF8C00;" edge="1" parent="1" source="node3" target="node4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="graph_equation" value="Edge weights:&lt;br&gt;$$w_{ij} = e^{-||p_i-p_j||^2/2\sigma^2} \cdot e^{-\angle(v_i,v_j)/2\sigma^2}$$" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="940" y="470" width="200" height="50" as="geometry" />
        </mxCell>
        
        <!-- GUIDED SAMPLING -->
        <mxCell id="guided_sampling" value="&lt;b&gt;Annealed Langevin Guided Sampling&lt;/b&gt;&lt;br&gt;&lt;br&gt;$$x_{t-1} = \mu_\theta(x_t,t) + \Sigma^{1/2}\epsilon - \lambda(t)\nabla_{x_t}E(x_t)$$&lt;br&gt;&lt;br&gt;Validity energy guides denoising steps" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F0E68C;strokeColor=#000000;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="300" y="580" width="500" height="100" as="geometry" />
        </mxCell>
        
        <!-- LOSS FUNCTION -->
        <mxCell id="loss_function" value="&lt;b&gt;Total Loss Function&lt;/b&gt;&lt;br&gt;&lt;br&gt;$$\mathcal{L} = \mathcal{L}_{diff} + \lambda_1\mathcal{L}_{coll} + \lambda_2\mathcal{L}_{kin} + \lambda_3\mathcal{L}_{social} + \lambda_4\mathcal{L}_{div}$$" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DDA0DD;strokeColor=#800080;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="860" y="580" width="400" height="80" as="geometry" />
        </mxCell>
        
        <!-- OUTPUT -->
        <mxCell id="output" value="&lt;b&gt;Valid Trajectories&lt;/b&gt;&lt;br&gt;✓ 94.2% Validity | ✓ 8.1% Collision Rate (↓67.3%) | ✓ 1.21m ADE" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#98FB98;strokeColor=#2E7D32;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="450" y="740" width="500" height="60" as="geometry" />
        </mxCell>
        
        <!-- PERFORMANCE METRICS BOX -->
        <mxCell id="metrics" value="&lt;b&gt;🎯 Performance Gains:&lt;/b&gt;&lt;br&gt;• 67.3% ↓ Collision Rate&lt;br&gt;• 94.2% Valid Trajectories&lt;br&gt;• 31.2% ↓ ADE" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#90EE90;strokeColor=#228B22;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="50" y="700" width="180" height="100" as="geometry" />
        </mxCell>
        
        <!-- VALIDITY ANNOTATION -->
        <mxCell id="validity_annotation" value="&lt;b&gt;Validity as&lt;br&gt;Architectural Primitive&lt;br&gt;NOT Emergent Property&lt;/b&gt;" style="text;html=1;strokeColor=#FF0000;fillColor=#FFFFFF;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="900" y="200" width="160" height="60" as="geometry" />
        </mxCell>
        
        <!-- FLOW ARROWS -->
        <!-- Input to Diffusion -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#4169E1;endArrow=classic;endFill=1;" edge="1" parent="1" source="scene_context" target="agent_stream">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#4169E1;endArrow=classic;endFill=1;" edge="1" parent="1" source="agent_states" target="scene_stream">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Diffusion to Validity -->
        <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#FF0000;endArrow=classic;endFill=1;" edge="1" parent="1" source="scene_stream" target="collision_module">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#FF0000;endArrow=classic;endFill=1;" edge="1" parent="1" source="scene_stream" target="kinematic_module">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Validity to Graph -->
        <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#FF8C00;endArrow=classic;endFill=1;" edge="1" parent="1" source="collision_module" target="graph_network">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- To Guided Sampling -->
        <mxCell id="arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#4169E1;endArrow=classic;endFill=1;" edge="1" parent="1" source="agent_stream" target="guided_sampling">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#4169E1;endArrow=classic;endFill=1;" edge="1" parent="1" source="graph_network" target="guided_sampling">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- To Loss -->
        <mxCell id="arrow8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#800080;endArrow=classic;endFill=1;dashed=1;" edge="1" parent="1" source="kinematic_module" target="loss_function">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- To Output -->
        <mxCell id="arrow9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#2E7D32;endArrow=classic;endFill=1;" edge="1" parent="1" source="guided_sampling" target="output">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Annotation Arrow -->
        <mxCell id="annotation_arrow" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#FF0000;endArrow=classic;endFill=1;" edge="1" parent="1" source="validity_annotation" target="collision_module">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>